<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title><l>Welcome to JWChat</l></title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<script src="config.js" language="JavaScript1.2"></script>
		<script src="browsercheck.js" language="JavaScript1.2"></script>
		<script src="shared.js" language="JavaScript1.2"></script>
		<script src="switchStyle.js"></script>
		<script language="JavaScript">
<!--

 /*
	* JWChat, a web based jabber client
	* Copyright (C) 2003-2004 Stefan Strigler <steve@zeank.in-berlin.de>
	*
	* This program is free software; you can redistribute it and/or
	* modify it under the terms of the GNU General Public License
	* as published by the Free Software Foundation; either version 2
	* of the License, or (at your option) any later version.
	*
	* This program is distributed in the hope that it will be useful,
	* but WITHOUT ANY WARRANTY; without even the implied warranty of
	* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	* GNU General Public License for more details.
	*
	* You should have received a copy of the GNU General Public License
	* along with this program; if not, write to the Free Software
	* Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
	*
	* Please visit http://jwchat.sourceforge.net for more information!
	*/

var jid, pass, register, prio, connect_host, connect_port, connect_secure;
var jwchats = new Array();

var JABBERSERVER;
var HTTPBASE;
var BACKEND_TYPE;
var GUEST_ACC;
var GUEST_PWD;

/** Retrieve user name from URL parameters.
	*/
function getUserName() {
	var lsearch = location.search;
	var idx = lsearch.indexOf("jid=");
	if (idx >= 0) {
		var query = lsearch.substr(idx);
		idx = query.indexOf("&");
		if (idx > 0) {
			query = query.substring(0, idx);
		}
		var tmp_jid = query.substr("jid=".length);
		return tmp_jid;
	} else {
		return '';
	}
}

/** On page load if the user name given in jid parameter is a guest
	* auto-login the user with preconfigured password.
	*/
function tryAutoLogin() {
	var user_name = getUserName();

	if (typeof(GUEST_ACC) == 'undefined' || GUEST_ACC.length == 0) {
		// Ignore
	} else {
		if (user_name == GUEST_ACC) {
			jid = user_name + "@" + JABBERSERVER + "/" + DEFAULTRESOURCE + Math.round(Math.random()*1000);
			pass = GUEST_PWD;
			register = false;
			prio = DEFAULTPRIORITY;
			connect_secure = false;

			jwchats[jid] = window.open('jwchat.html',makeWindowName(jid),'width=320,height=250,resizable=yes');
			return true;
		}
	}
	return false;

}

/* check if user want's to register new
 * account and things */    
function loginCheck(form) { 
	if (form.jid.value == '') {
		alert(loc("You need to supply a username"));
		return false;
	}

	if (form.pass.value == '') {
		alert(loc("You need to supply a password"));
		return false;
	}

	if (document.getElementById('tr_server').style.display != 'none') {
		var val = document.getElementById('server').value;
		if (val == '') {
			alert(loc("You need to supply a jabber server"));
			return false;
		}

		JABBERSERVER = val;
	}

	jid = form.jid.value + "@" + JABBERSERVER + "/";
	if (form.res.value != '')
		jid += form.res.value;
	else
		jid += DEFAULTRESOURCE;

	if(!isValidJID(jid))
		return false;

	if (jwchats[jid] && !jwchats[jid].closed) {
		jwchats[jid].focus();
		return false;
	}

	pass = form.pass.value;
	register = form.register.checked;

	prio = form.prio[form.prio.selectedIndex].value;

	connect_port = form.connect_port.value;
	connect_host = form.connect_host.value;
	connect_secure = form.connect_secure.checked;

	jwchats[jid] = window.open('jwchat.html',makeWindowName(jid),'width=320,height=250,resizable=yes');

	return false;
}

function toggleMoreOpts(show) {
	if (show) {
		document.getElementById('showMoreOpts').style.display = 'none';
		document.getElementById('showLessOpts').style.display = '';
	} else {
		document.getElementById('showLessOpts').style.display = 'none';
		document.getElementById('showMoreOpts').style.display = '';
	}

	var rows = document.getElementById('lTable').getElementsByTagName('TBODY').item(0).getElementsByTagName('TR');

	for (var i=0; i<rows.length; i++) {
		if (rows[i].className == 'moreOpts') {
			if (show)
	rows[i].style.display = '';
			else
	rows[i].style.display = 'none';
		}
	}
	return false;
}

function serverSelected() {
	var oSel = document.getElementById('server');
	var servers_allowed = BACKENDS[bs.selectedIndex].servers_allowed;

	// TODO ...
	
	/* change format of servers_allowed to be able to associate connect 
	 * host information to it 
	 */
}

function backendSelected() {
	var bs = document.getElementById('backend_selector');
	var servers_allowed, default_server;
	if (bs) {
		servers_allowed = BACKENDS[bs.selectedIndex].servers_allowed;
		default_server = BACKENDS[bs.selectedIndex].default_server;
		if (BACKENDS[bs.selectedIndex].description)
			document.getElementById('backend_description').innerHTML = BACKENDS[bs.selectedIndex].description;
		HTTPBASE = BACKENDS[bs.selectedIndex].httpbase;
		BACKEND_TYPE = BACKENDS[bs.selectedIndex].type;
	}	else {
		servers_allowed = BACKENDS[0].servers_allowed;
		default_server = BACKENDS[0].default_server;
		HTTPBASE = BACKENDS[0].httpbase;
		BACKEND_TYPE = BACKENDS[0].type;
	}
	
	if (!servers_allowed
			|| servers_allowed.length == 0) 
		{ // allow any
			var tr_server = document.getElementById('tr_server');
			
			var input = document.createElement('input');
			input.setAttribute("type","text");
			input.setAttribute("id","server");
			input.setAttribute("name","server");
			input.setAttribute("tabindex","2");
			input.className = 'input_text';
			
			if (default_server)
	input.setAttribute("value",default_server);
			
			var td = tr_server.getElementsByTagName('td').item(0);
			for (var i=0; i<td.childNodes.length; i++)
	td.removeChild(td.childNodes.item(i));
			
			td.appendChild(input);
			
			tr_server.style.display = ''; 
			
			document.getElementById('connect_port').disabled = false;
			document.getElementById('connect_host').disabled = false;
			document.getElementById('connect_secure').disabled = false;
		}
	else if (servers_allowed.length == 1) {
		document.getElementById('tr_server').style.display = 'none';
		JABBERSERVER = servers_allowed[0];
		document.getElementById('connect_port').disabled = true;
		document.getElementById('connect_host').disabled = true;
		document.getElementById('connect_secure').disabled = true;
	} else { // create selectbox
		var tr_server = document.getElementById('tr_server');
		
		var oSelect = document.createElement('select');
		oSelect.setAttribute('id','server');
		oSelect.setAttribute('name','server');
		oSelect.setAttribute('tabindex',"2");
		oSelect.onchange = serverSelected;
		
		var td = tr_server.getElementsByTagName('td').item(0);
		for (var i=0; i<td.childNodes.length; i++)
			td.removeChild(td.childNodes.item(i));
		
		td.appendChild(oSelect);
		
		for (var i=0; i<servers_allowed.length; i++) {
			if (typeof(servers_allowed[i]) == 'undefined')
	continue;
			oSelect.options.add(new Option(servers_allowed[i],servers_allowed[i]));
		}
		
		tr_server.style.display = ''; 
		document.getElementById('connect_port').disabled = true;
		document.getElementById('connect_host').disabled = true;
		document.getElementById('connect_secure').disabled = true;
	}
}

function init() {
	var welcome = loc("Welcome to JWChat at [_1]", SITENAME);
	document.title = welcome;
	document.getElementById("welcomeh1").innerHTML = welcome;

	// create backend chooser - if any
	if (typeof(BACKENDS) == 'undefined' || BACKENDS.length == 0) {
		// ...
	} else if (BACKENDS.length == 1) {
		backendSelected();
	} else {
		// create chooser
		var oSelect = document.createElement('select');
		oSelect.setAttribute('id','backend_selector');
		oSelect.setAttribute('name','backend');
		oSelect.setAttribute('tabindex',"1");
		oSelect.onchange = backendSelected;

		var tr = document.createElement('tr');
		var td = tr.appendChild(document.createElement('th'));
		var label = td.appendChild(document.createElement('label'));
		label.setAttribute('for','backend_selector');
		label.appendChild(document.createTextNode(loc("Choose Backend")));
		
		tr.appendChild(document.createElement('td')).appendChild(oSelect);
		
		var tr_server = document.getElementById('tr_server');
		tr_server.parentNode.insertBefore(tr,tr_server);
		
		tr = document.createElement('tr');
		td = tr.appendChild(document.createElement('td'));
		td = document.createElement('td');
		td.setAttribute('id','backend_description');
		td.className= 'desc';
		tr.appendChild(td);

		tr_server.parentNode.insertBefore(tr,tr_server);

		for (var i=0; i<BACKENDS.length; i++) {
			if (typeof(BACKENDS[i]) == 'undefined')
	continue;
			var oOption =  new Option(BACKENDS[i].name,BACKENDS[i].httpbase);
			oOption.setAttribute('description',BACKENDS[i].description);
			oSelect.options[i] = oOption;
		}
		
		backendSelected();
	}
	document.forms[0].jid.focus();
	document.getElementById('chars_prohibited').innerHTML = prohibited;
	if (typeof(DEFAULTRESOURCE) != 'undefined' && DEFAULTRESOURCE)
		document.forms[0].res.value = DEFAULTRESOURCE;
	
	if (getUserName().length > 0) {
		document.getElementById('jid').setAttribute('value', getUserName());
	}

	document.getElementById('login_button').disabled = false;

	//tryAutoLogin();
}


onload = init;
//-->
		</script>

		<link rel="stylesheet" type="text/css" href="css/style.css" />

	</head>
	
	<body>


		<div class='container' style='margin-top:40px'>

			<img src='images/logo.png' style='height:50px; margin-bottom:20px' />

			<div class='row'>
				<div class='span4'>
					<!-- 
					<div class="vine-chat-bubble vine-chat-bubble-left">
						<h1>Vine Demo</h1>
					</div>
 -->

 					<div>
 						<p>
 							Take Vine.im for a test drive. Click the 'launch demo' button below to open a simple in browser jabber client
 						</p>
 					</div>
					<a id='login_button' class='btn btn-warning' onClick='tryAutoLogin();' style='width:100%;text-align:center;padding:0'><h2>Launch Demo</h2></a>
<!-- 
					<form name="login" onSubmit="return loginCheck(this);">
						<legend>login</legend>
						<label>username</label>
						<input type="text" id='jid' name="jid" tabindex=3 class='input_text' placeholder="username">
						<label>password</label>
						<input type="password" id='pass' name="pass" tabindex=4 class='input_text' placeholder='password'>
						</br>
						<button type="submit" id='login_button' class='btn' tabindex=5 disabled>Login</button>
					</form>	
					 -->
				</div>

				<div class='span8'>
					<iframe width="620" height="360" src="http://www.youtube.com/embed/CayMeza487M" frameborder="0" allowfullscreen></iframe>
				</div>

			</div>

			<div class='row'>
				<div class='span12'>
					Vine.im demo uses <a href="http://blog.jwchat.org/jwchat/">JWChat</a> for it's web client 
				</div>
			</div>

		</div>


	</body>
</html>
